/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(
  // If the importer is in node compatibility mode or this is not an ESM
  // file that has been converted to a CommonJS file using a Babel-
  // compatible transform (i.e. "__esModule" has not been set), then set
  // "default" to the CommonJS "module.exports" for node compatibility.
  isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target,
  mod
));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MarkdownBlogger
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var fs = __toESM(require("fs"));
var path = __toESM(require("path"));
var os = __toESM(require("os"));
var DEFAULT_SETTINGS = {
  projectFolder: "",
  showHiddenFolders: false
};
var MarkdownBlogger = class extends import_obsidian.Plugin {
  async onload() {
    await this.loadSettings();
    this.addCommand({
      id: "validate-path",
      name: "Validate path",
      editorCallback: (editor, view) => {
        const { projectFolder } = this.settings;
        if (!fs.existsSync(projectFolder)) {
          new ErrorModal(this.app).open();
          return;
        }
        new import_obsidian.Notice(`Valid path: ${this.settings.projectFolder}`);
      }
    });
    this.addCommand({
      id: "push-md",
      name: "Push markdown",
      editorCallback: (editor, view) => {
        const { projectFolder } = this.settings;
        if (!fs.existsSync(projectFolder)) {
          new ErrorModal(this.app).open();
          return;
        }
        const text = editor.getDoc().getValue();
        const projectBlogPath = path.resolve(this.settings.projectFolder, view.file.name);
        try {
          fs.writeFileSync(`${projectBlogPath}`, text, { encoding: "utf8" });
          new import_obsidian.Notice(`Your file has been pushed! At ${projectBlogPath}`);
        } catch (err) {
          new import_obsidian.Notice(err.message);
        }
      }
    });
    this.addCommand({
      id: "pull-md",
      name: "Pull markdown",
      editorCheckCallback: (checking, editor, view) => {
        const projectBlogPath = path.resolve(this.settings.projectFolder, view.file.name);
        if (fs.existsSync(projectBlogPath)) {
          if (!checking) {
            try {
              const file = fs.readFileSync(projectBlogPath, "utf8");
              editor.getDoc().setValue(file);
              new import_obsidian.Notice(`Your file has been pulled! From ${projectBlogPath}`);
            } catch (err) {
              new import_obsidian.Notice(err.message);
            }
          }
          return true;
        }
        return false;
      }
    });
    this.addCommand({
      id: "push-custom-path-md",
      name: "Push to custom path",
      editorCallback: (editor, view) => {
        new PathModal(this.app, this.settings, 0 /* Push */).open();
      }
    });
    this.addCommand({
      id: "pull-custom-path",
      name: "Pull from custom path",
      editorCallback: (editor, view) => {
        new PathModal(this.app, this.settings, 1 /* Pull */).open();
      }
    });
    this.addSettingTab(new MarkdownBloggerSettingTab(this.app, this));
  }
  onunload() {
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var ErrorModal = class extends import_obsidian.Modal {
  constructor(app) {
    super(app);
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.setText("The project folder does not exist. Please create the path or update the current path in plugin settings.");
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
var PathModal = class extends import_obsidian.FuzzySuggestModal {
  constructor(app, settings, action) {
    super(app);
    this.currPath = os.homedir();
    this.settings = settings;
    this.action = action;
  }
  getItems() {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    const paths = fs.readdirSync(this.currPath).filter((p) => {
      const fullPath = path.resolve(this.currPath, p);
      let stats;
      try {
        stats = fs.statSync(fullPath, { throwIfNoEntry: false });
      } catch (e) {
        return false;
      }
      if (stats === void 0)
        return false;
      return (stats.isDirectory() || path.basename(fullPath) === (view == null ? void 0 : view.file.name)) && (p[0] !== "." || this.settings.showHiddenFolders);
    });
    paths.push("..");
    paths.push("Select");
    return paths;
  }
  getItemText(dir) {
    return dir;
  }
  onChooseItem(dir, evt) {
    const view = this.app.workspace.getActiveViewOfType(import_obsidian.MarkdownView);
    if (dir === "Select") {
      if (view) {
        if (!fs.existsSync(path.resolve(this.currPath))) {
          new ErrorModal(this.app).open();
          return;
        }
        const text = view.editor.getDoc().getValue();
        const filePath = path.resolve(this.currPath, view.file.name);
        if (this.action === 0 /* Push */) {
          try {
            fs.writeFileSync(`${filePath}`, text, { encoding: "utf8" });
            new import_obsidian.Notice(`Your file has been pushed! At ${filePath}`);
          } catch (err) {
            new import_obsidian.Notice(err.message);
          }
        } else if (this.action === 1 /* Pull */) {
          try {
            const file = fs.readFileSync(filePath, "utf8");
            view.editor.getDoc().setValue(file);
            new import_obsidian.Notice(`Your file has been pulled! From ${filePath}`);
          } catch (err) {
            new import_obsidian.Notice(err.message);
          }
        }
      }
      return;
    } else if (view && dir === view.file.name) {
      const filePath = path.resolve(this.currPath, view.file.name);
      if (this.action === 0 /* Push */) {
        const text = view.editor.getDoc().getValue();
        try {
          fs.writeFileSync(`${filePath}`, text, { encoding: "utf8" });
          new import_obsidian.Notice(`Your file has been pushed! At ${filePath}`);
        } catch (err) {
          new import_obsidian.Notice(err.message);
        }
      } else if (this.action === 1 /* Pull */) {
        try {
          const file = fs.readFileSync(filePath, "utf8");
          view.editor.getDoc().setValue(file);
          new import_obsidian.Notice(`Your file has been pulled! From ${filePath}`);
        } catch (err) {
          new import_obsidian.Notice(err.message);
        }
      }
      return;
    } else {
      this.currPath = path.normalize(path.join(this.currPath, dir));
    }
    this.open();
  }
};
var MarkdownBloggerSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Settings for Obsidian Markdown Blogger." });
    new import_obsidian.Setting(containerEl).setName("Local project folder path").setDesc("The local project folder for your blog, portfolio, or static site. Must be an absolute path.").addText(
      (text) => text.setPlaceholder("/Users/johnsample/projects/astro-blog/collections/").setValue(this.plugin.settings.projectFolder).onChange(async (value) => {
        this.plugin.settings.projectFolder = value;
        await this.plugin.saveSettings();
      })
    );
    new import_obsidian.Setting(containerEl).setName("Show hidden folders").setDesc("Show hidden folders when pushing to a custom path").addToggle(
      (cb) => cb.setValue(this.plugin.settings.showHiddenFolders).onChange(async (value) => {
        this.plugin.settings.showHiddenFolders = value;
        await this.plugin.saveSettings();
      })
    );
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBFZGl0b3IsIEZ1enp5U3VnZ2VzdE1vZGFsLCBNYXJrZG93blZpZXcsIE1vZGFsLCBOb3RpY2UsIFBsdWdpbiwgUGx1Z2luU2V0dGluZ1RhYiwgU2V0dGluZyB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgKiBhcyBvcyBmcm9tIFwib3NcIjtcblxuaW50ZXJmYWNlIE1hcmtkb3duQmxvZ2dlclNldHRpbmdzIHtcblx0cHJvamVjdEZvbGRlcjogc3RyaW5nO1xuXHRzaG93SGlkZGVuRm9sZGVyczogYm9vbGVhbjtcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTWFya2Rvd25CbG9nZ2VyU2V0dGluZ3MgPSB7XG5cdHByb2plY3RGb2xkZXI6IFwiXCIsXG5cdHNob3dIaWRkZW5Gb2xkZXJzOiBmYWxzZVxuXG59XG5lbnVtIEFjdGlvbiB7XG5cdFB1c2gsXG5cdFB1bGxcbn1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hcmtkb3duQmxvZ2dlciBleHRlbmRzIFBsdWdpbiB7XG5cdHNldHRpbmdzOiBNYXJrZG93bkJsb2dnZXJTZXR0aW5ncztcblxuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0YXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogXCJ2YWxpZGF0ZS1wYXRoXCIsXG5cdFx0XHRuYW1lOiBcIlZhbGlkYXRlIHBhdGhcIixcblx0XHRcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRcblx0XHRcdFx0Y29uc3QgeyBwcm9qZWN0Rm9sZGVyIH0gPSB0aGlzLnNldHRpbmdzO1xuXHRcdFx0XHRpZiAoIWZzLmV4aXN0c1N5bmMocHJvamVjdEZvbGRlcikpIHtcblx0XHRcdFx0XHRuZXcgRXJyb3JNb2RhbCh0aGlzLmFwcCkub3BlbigpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXHRcdFx0XHRuZXcgTm90aWNlKGBWYWxpZCBwYXRoOiAke3RoaXMuc2V0dGluZ3MucHJvamVjdEZvbGRlcn1gKTtcblx0XHRcdH0sXG5cdFx0fSk7XG5cblx0XHR0aGlzLmFkZENvbW1hbmQoe1xuXHRcdFx0aWQ6IFwicHVzaC1tZFwiLFxuXHRcdFx0bmFtZTogXCJQdXNoIG1hcmtkb3duXCIsXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcblx0XHRcdFx0XG5cdFx0XHRcdGNvbnN0IHsgcHJvamVjdEZvbGRlciB9ID0gdGhpcy5zZXR0aW5ncztcblx0XHRcdFx0aWYgKCFmcy5leGlzdHNTeW5jKHByb2plY3RGb2xkZXIpKSB7XG5cdFx0XHRcdFx0bmV3IEVycm9yTW9kYWwodGhpcy5hcHApLm9wZW4oKTtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0Y29uc3QgdGV4dCA9IGVkaXRvci5nZXREb2MoKS5nZXRWYWx1ZSgpO1xuXHRcdFx0XHRjb25zdCBwcm9qZWN0QmxvZ1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5zZXR0aW5ncy5wcm9qZWN0Rm9sZGVyLCB2aWV3LmZpbGUubmFtZSk7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0ZnMud3JpdGVGaWxlU3luYyhgJHtwcm9qZWN0QmxvZ1BhdGh9YCwgdGV4dCwge2VuY29kaW5nOiBcInV0ZjhcIn0pO1xuXHRcdFx0XHRcdG5ldyBOb3RpY2UoYFlvdXIgZmlsZSBoYXMgYmVlbiBwdXNoZWQhIEF0ICR7cHJvamVjdEJsb2dQYXRofWApO1xuXHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRuZXcgTm90aWNlKGVyci5tZXNzYWdlKTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogXCJwdWxsLW1kXCIsXG5cdFx0XHRuYW1lOiBcIlB1bGwgbWFya2Rvd25cIixcblx0XHRcdGVkaXRvckNoZWNrQ2FsbGJhY2s6IChjaGVja2luZzogYm9vbGVhbiwgZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRjb25zdCBwcm9qZWN0QmxvZ1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5zZXR0aW5ncy5wcm9qZWN0Rm9sZGVyLCB2aWV3LmZpbGUubmFtZSk7XG5cdFx0XHRcblx0XHRcdFx0aWYgKGZzLmV4aXN0c1N5bmMocHJvamVjdEJsb2dQYXRoKSkge1xuXHRcdFx0XHRcdGlmICghY2hlY2tpbmcpIHtcblx0XHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRcdGNvbnN0IGZpbGUgPSBmcy5yZWFkRmlsZVN5bmMocHJvamVjdEJsb2dQYXRoLCBcInV0ZjhcIik7XG5cdFx0XHRcdFx0XHRcdGVkaXRvci5nZXREb2MoKS5zZXRWYWx1ZShmaWxlKTtcblx0XHRcdFx0XHRcdFx0bmV3IE5vdGljZShgWW91ciBmaWxlIGhhcyBiZWVuIHB1bGxlZCEgRnJvbSAke3Byb2plY3RCbG9nUGF0aH1gKTtcblx0XHRcdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdFx0XHRuZXcgTm90aWNlKGVyci5tZXNzYWdlKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0fSxcblx0XHR9KTtcblxuXHRcdHRoaXMuYWRkQ29tbWFuZCh7XG5cdFx0XHRpZDogXCJwdXNoLWN1c3RvbS1wYXRoLW1kXCIsXG5cdFx0XHRuYW1lOiBcIlB1c2ggdG8gY3VzdG9tIHBhdGhcIixcblx0XHRcdGVkaXRvckNhbGxiYWNrOiAoZWRpdG9yOiBFZGl0b3IsIHZpZXc6IE1hcmtkb3duVmlldykgPT4ge1xuXHRcdFx0XHRuZXcgUGF0aE1vZGFsKHRoaXMuYXBwLCB0aGlzLnNldHRpbmdzLCBBY3Rpb24uUHVzaCkub3BlbigpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0dGhpcy5hZGRDb21tYW5kKHtcblx0XHRcdGlkOiBcInB1bGwtY3VzdG9tLXBhdGhcIixcblx0XHRcdG5hbWU6IFwiUHVsbCBmcm9tIGN1c3RvbSBwYXRoXCIsXG5cdFx0XHRlZGl0b3JDYWxsYmFjazogKGVkaXRvcjogRWRpdG9yLCB2aWV3OiBNYXJrZG93blZpZXcpID0+IHtcblx0XHRcdFx0bmV3IFBhdGhNb2RhbCh0aGlzLmFwcCwgdGhpcy5zZXR0aW5ncywgQWN0aW9uLlB1bGwpLm9wZW4oKVxuXHRcdFx0fVxuXHRcdH0pXG5cblx0XHQvLyBUaGlzIGFkZHMgYSBzZXR0aW5ncyB0YWIgc28gdGhlIHVzZXIgY2FuIGNvbmZpZ3VyZSB2YXJpb3VzIGFzcGVjdHMgb2YgdGhlIHBsdWdpblxuXHRcdHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTWFya2Rvd25CbG9nZ2VyU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXHR9XG5cblx0b251bmxvYWQoKSB7XG5cblx0fVxuXG5cdGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcblx0XHR0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcblx0fVxuXG5cdGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcblx0XHRhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuXHR9XG59XG5cbmNsYXNzIEVycm9yTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG5cdGNvbnN0cnVjdG9yKGFwcDogQXBwKSB7XG5cdFx0c3VwZXIoYXBwKTtcblx0fVxuXG5cdG9uT3BlbigpIHtcblx0XHRjb25zdCB7Y29udGVudEVsfSA9IHRoaXM7XG5cdFx0Y29udGVudEVsLnNldFRleHQoXCJUaGUgcHJvamVjdCBmb2xkZXIgZG9lcyBub3QgZXhpc3QuIFBsZWFzZSBjcmVhdGUgdGhlIHBhdGggb3IgdXBkYXRlIHRoZSBjdXJyZW50IHBhdGggaW4gcGx1Z2luIHNldHRpbmdzLlwiKTtcblx0fVxuXG5cdG9uQ2xvc2UoKSB7XG5cdFx0Y29uc3Qge2NvbnRlbnRFbH0gPSB0aGlzO1xuXHRcdGNvbnRlbnRFbC5lbXB0eSgpO1xuXHR9XG59XG5cbmNsYXNzIFBhdGhNb2RhbCBleHRlbmRzIEZ1enp5U3VnZ2VzdE1vZGFsPHN0cmluZz4ge1xuXHRjdXJyUGF0aCA9IG9zLmhvbWVkaXIoKTtcblx0c2V0dGluZ3M6IE1hcmtkb3duQmxvZ2dlclNldHRpbmdzXG5cdGFjdGlvbjogQWN0aW9uXG5cblx0Y29uc3RydWN0b3IoYXBwOiBBcHAsIHNldHRpbmdzOiBNYXJrZG93bkJsb2dnZXJTZXR0aW5ncywgYWN0aW9uOiBBY3Rpb24pIHtcblx0XHRzdXBlcihhcHApO1xuXHRcdHRoaXMuc2V0dGluZ3MgPSBzZXR0aW5ncztcblx0XHR0aGlzLmFjdGlvbiA9IGFjdGlvbjtcblx0fVxuXHRcblx0Z2V0SXRlbXMoKTogc3RyaW5nW10ge1xuXHRcdGNvbnN0IHZpZXcgPSB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0QWN0aXZlVmlld09mVHlwZShNYXJrZG93blZpZXcpO1xuXG5cdFx0Y29uc3QgcGF0aHMgPSBmcy5yZWFkZGlyU3luYyh0aGlzLmN1cnJQYXRoKS5maWx0ZXIoKHApID0+IHtcblx0XHRcdGNvbnN0IGZ1bGxQYXRoID0gcGF0aC5yZXNvbHZlKHRoaXMuY3VyclBhdGgsIHApO1xuXHRcdFx0bGV0IHN0YXRzO1xuXHRcdFx0dHJ5IHsgc3RhdHMgPSBmcy5zdGF0U3luYyhmdWxsUGF0aCwgeyB0aHJvd0lmTm9FbnRyeTogZmFsc2UgfSk7IH0gY2F0Y2ggKGUpIHsgcmV0dXJuIGZhbHNlOyB9XG5cdFx0XHRpZiAoc3RhdHMgPT09IHVuZGVmaW5lZCkgcmV0dXJuIGZhbHNlO1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0KHN0YXRzLmlzRGlyZWN0b3J5KClcblx0XHRcdFx0fHwgKHBhdGguYmFzZW5hbWUoZnVsbFBhdGgpID09PSB2aWV3Py5maWxlLm5hbWUpKVxuXHRcdFx0XHQmJiAocFswXSAhPT0gXCIuXCIgfHwgdGhpcy5zZXR0aW5ncy5zaG93SGlkZGVuRm9sZGVycylcblx0XHRcdCk7XG5cdFx0fSk7XG5cdFx0XG5cdFx0cGF0aHMucHVzaChcIi4uXCIpO1xuXHRcdHBhdGhzLnB1c2goXCJTZWxlY3RcIik7XG5cblx0XHRyZXR1cm4gcGF0aHM7XG5cdH1cblx0Z2V0SXRlbVRleHQoZGlyOiBzdHJpbmcpOiBzdHJpbmcge1xuXHRcdHJldHVybiBkaXI7XG5cdH1cblx0b25DaG9vc2VJdGVtKGRpcjogc3RyaW5nLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG5cdFx0Y29uc3QgdmlldyA9IHRoaXMuYXBwLndvcmtzcGFjZS5nZXRBY3RpdmVWaWV3T2ZUeXBlKE1hcmtkb3duVmlldyk7XG5cdFx0aWYgKGRpciA9PT0gXCJTZWxlY3RcIikge1xuXHRcdFx0aWYgKHZpZXcpIHtcblx0XHRcdFx0aWYgKCFmcy5leGlzdHNTeW5jKHBhdGgucmVzb2x2ZSh0aGlzLmN1cnJQYXRoKSkpIHtcblx0XHRcdFx0XHRuZXcgRXJyb3JNb2RhbCh0aGlzLmFwcCkub3BlbigpO1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNvbnN0IHRleHQgPSB2aWV3LmVkaXRvci5nZXREb2MoKS5nZXRWYWx1ZSgpO1xuXHRcdFx0XHRjb25zdCBmaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmN1cnJQYXRoLCB2aWV3LmZpbGUubmFtZSk7XG5cdFx0XHRcdGlmICh0aGlzLmFjdGlvbiA9PT0gQWN0aW9uLlB1c2gpIHtcblx0XHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdFx0ZnMud3JpdGVGaWxlU3luYyhgJHtmaWxlUGF0aH1gLCB0ZXh0LCB7ZW5jb2Rpbmc6IFwidXRmOFwifSk7XG5cdFx0XHRcdFx0XHRuZXcgTm90aWNlKGBZb3VyIGZpbGUgaGFzIGJlZW4gcHVzaGVkISBBdCAke2ZpbGVQYXRofWApO1xuXHRcdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdFx0bmV3IE5vdGljZShlcnIubWVzc2FnZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGVsc2UgaWYgKHRoaXMuYWN0aW9uID09PSBBY3Rpb24uUHVsbCkge1xuXHRcdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0XHRjb25zdCBmaWxlID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCBcInV0ZjhcIik7XG5cdFx0XHRcdFx0XHR2aWV3LmVkaXRvci5nZXREb2MoKS5zZXRWYWx1ZShmaWxlKTtcblx0XHRcdFx0XHRcdG5ldyBOb3RpY2UoYFlvdXIgZmlsZSBoYXMgYmVlbiBwdWxsZWQhIEZyb20gJHtmaWxlUGF0aH1gKTtcblx0XHRcdFx0XHR9IGNhdGNoIChlcnIpIHtcblx0XHRcdFx0XHRcdG5ldyBOb3RpY2UoZXJyLm1lc3NhZ2UpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH0gZWxzZSBpZiAodmlldyAmJiBkaXIgPT09IHZpZXcuZmlsZS5uYW1lKSB7XG5cdFx0XHRjb25zdCBmaWxlUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLmN1cnJQYXRoLCB2aWV3LmZpbGUubmFtZSk7XG5cdFx0XHRpZiAodGhpcy5hY3Rpb24gPT09IEFjdGlvbi5QdXNoKSB7XG5cdFx0XHRcdGNvbnN0IHRleHQgPSB2aWV3LmVkaXRvci5nZXREb2MoKS5nZXRWYWx1ZSgpO1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGZzLndyaXRlRmlsZVN5bmMoYCR7ZmlsZVBhdGh9YCwgdGV4dCwge2VuY29kaW5nOiBcInV0ZjhcIn0pO1xuXHRcdFx0XHRcdG5ldyBOb3RpY2UoYFlvdXIgZmlsZSBoYXMgYmVlbiBwdXNoZWQhIEF0ICR7ZmlsZVBhdGh9YCk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdG5ldyBOb3RpY2UoZXJyLm1lc3NhZ2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMuYWN0aW9uID09PSBBY3Rpb24uUHVsbCkge1xuXHRcdFx0XHR0cnkge1xuXHRcdFx0XHRcdGNvbnN0IGZpbGUgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsIFwidXRmOFwiKTtcblx0XHRcdFx0XHR2aWV3LmVkaXRvci5nZXREb2MoKS5zZXRWYWx1ZShmaWxlKTtcblx0XHRcdFx0XHRuZXcgTm90aWNlKGBZb3VyIGZpbGUgaGFzIGJlZW4gcHVsbGVkISBGcm9tICR7ZmlsZVBhdGh9YCk7XG5cdFx0XHRcdH0gY2F0Y2ggKGVycikge1xuXHRcdFx0XHRcdG5ldyBOb3RpY2UoZXJyLm1lc3NhZ2UpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm47XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuY3VyclBhdGggPSBwYXRoLm5vcm1hbGl6ZShwYXRoLmpvaW4odGhpcy5jdXJyUGF0aCwgZGlyKSk7XG5cdFx0fVxuXHRcdHRoaXMub3BlbigpO1xuXHR9XG59XG5cbmNsYXNzIE1hcmtkb3duQmxvZ2dlclNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcblx0cGx1Z2luOiBNYXJrZG93bkJsb2dnZXI7XG5cblx0Y29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogTWFya2Rvd25CbG9nZ2VyKSB7XG5cdFx0c3VwZXIoYXBwLCBwbHVnaW4pO1xuXHRcdHRoaXMucGx1Z2luID0gcGx1Z2luO1xuXHR9XG5cblx0ZGlzcGxheSgpOiB2b2lkIHtcblx0XHRjb25zdCB7Y29udGFpbmVyRWx9ID0gdGhpcztcblxuXHRcdGNvbnRhaW5lckVsLmVtcHR5KCk7XG5cblx0XHRjb250YWluZXJFbC5jcmVhdGVFbChcImgyXCIsIHt0ZXh0OiBcIlNldHRpbmdzIGZvciBPYnNpZGlhbiBNYXJrZG93biBCbG9nZ2VyLlwifSk7XG5cblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbClcblx0XHRcdC5zZXROYW1lKFwiTG9jYWwgcHJvamVjdCBmb2xkZXIgcGF0aFwiKVxuXHRcdFx0LnNldERlc2MoXCJUaGUgbG9jYWwgcHJvamVjdCBmb2xkZXIgZm9yIHlvdXIgYmxvZywgcG9ydGZvbGlvLCBvciBzdGF0aWMgc2l0ZS4gTXVzdCBiZSBhbiBhYnNvbHV0ZSBwYXRoLlwiKVxuXHRcdFx0LmFkZFRleHQodGV4dCA9PiB0ZXh0XG5cdFx0XHRcdC5zZXRQbGFjZWhvbGRlcihcIi9Vc2Vycy9qb2huc2FtcGxlL3Byb2plY3RzL2FzdHJvLWJsb2cvY29sbGVjdGlvbnMvXCIpXG5cdFx0XHRcdC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5wcm9qZWN0Rm9sZGVyKVxuXHRcdFx0XHQub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5wbHVnaW4uc2V0dGluZ3MucHJvamVjdEZvbGRlciA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KVxuXHRcdFx0KTtcblx0XHRuZXcgU2V0dGluZyhjb250YWluZXJFbCkuc2V0TmFtZShcIlNob3cgaGlkZGVuIGZvbGRlcnNcIilcblx0XHRcdC5zZXREZXNjKFwiU2hvdyBoaWRkZW4gZm9sZGVycyB3aGVuIHB1c2hpbmcgdG8gYSBjdXN0b20gcGF0aFwiKVxuXHRcdFx0LmFkZFRvZ2dsZShjYiA9PiBjYlxuXHRcdFx0XHQuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3Muc2hvd0hpZGRlbkZvbGRlcnMpXG5cdFx0XHRcdC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcblx0XHRcdFx0XHR0aGlzLnBsdWdpbi5zZXR0aW5ncy5zaG93SGlkZGVuRm9sZGVycyA9IHZhbHVlO1xuXHRcdFx0XHRcdGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuXHRcdFx0XHR9KVxuXHRcdFx0KTtcdFx0XHRcdFxuXHR9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
